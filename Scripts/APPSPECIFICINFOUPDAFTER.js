 /** * Accela Automation * $Id: AgencySeqDAOOracle.java 106715 2008-09-26 06:23:12Z ACHIEVO\jack.su $ * * Accela, Inc. * Copyright (C): 2007-2008 * * Description: * AgencySeqDAOOracle is the ADOOracle class to operate on the tables for agency level sequences * * Notes: * * Revision History: * 2007-12-04     Vernon Crandall	Initial Version */var capID=getCapId();var	altID=capID.getCustomID();var currentUserID = aa.env.getValue("CurrentUserID"); var cap = aa.cap.getCap(capID).getOutput();	var capType = cap.getCapType();var filterName=aa.cap.getCapTypeFilterName(capType).getOutput();aa.print("filterName:"+filterName);aa.print("capID:"+capID.toString());/** * Get asi field name list. these field is used to store Trade Name list. *  * @return */function getASIFieldNamesForTN(){	var tradeNameGroupCount=11;	var result=[];	var tradeNameSubgroup="TRADE NAME CHOICES";	var englishASIFieldPrefix="English Alternate "	var arabicASIFieldPrefix="Arabic Alternate "	for(var i=0;i<tradeNameGroupCount;++i){		var index=(i==0?'':String(i));		var isPrefered=(i==0?true:false);		var obj={			subgroup:			tradeNameSubgroup.toUpperCase(),			englishFieldName:	englishASIFieldPrefix.toUpperCase()+index,			arabicFieldName:	arabicASIFieldPrefix.toUpperCase()+index,			isPrefered:			isPrefered		};		if (isPrefered) {			 obj.englishFieldName = "English Prefered Name";			 obj.arabicFieldName = "Arabic Prefered Name";		}		aa.print("englishFieldName:\t"+obj.englishFieldName);		aa.print("arabicFieldName:\t"+obj.arabicFieldName);		aa.print("isPrefered:\t"+obj.isPrefered);		aa.print("--------------------");		result[i]=obj;	}	return result;};/** * Retrieve search data from CAP ASI fields *  * @return */var retrieveSearchDataFromASI=function(){	var tradeNameFieldList=getASIFieldNamesForTN();	var scriptResult=aa.appSpecificInfo.getByCapID(capID);	if(scriptResult.success){		var asiFields=scriptResult.getOutput();		for(var i=0;i<asiFields.length;++i){			var asiModel=asiFields[i];// AppSpecificInfoModel			var subgroup=asiModel.getCheckboxType().toUpperCase();			var fieldName=asiModel.getFieldLabel().toUpperCase();			var value=asiModel.getChecklistComment();			for(var k=0;k<tradeNameFieldList.length;++k){				var obj=tradeNameFieldList[k];				if(obj && obj.subgroup==subgroup){					if(obj.englishFieldName.toUpperCase()==fieldName.toUpperCase()){						obj.englishFieldValue=aa.specialSearch.getPureEnglishText(value).getOutput();						obj.originalEnglishTradeName=value;						break;					}else if(obj.arabicFieldName.toUpperCase()==fieldName.toUpperCase()){						obj.arabicFieldValue=aa.specialSearch.getPureArabicText(value).getOutput();						obj.originalArabicTradeName=value;						break;					}				}			}		}		return tradeNameFieldList;	}		return null;}function getCapId() {	var s_id1 = aa.env.getValue("PermitId1");	var s_id2 = aa.env.getValue("PermitId2");	var s_id3 = aa.env.getValue("PermitId3");	var s_capResult = aa.cap.getCapID(s_id1, s_id2, s_id3);	if (s_capResult.getSuccess()) {		return s_capResult.getOutput();	}else {		aa.print("**ERROR: Failed to get capId: " + s_capResult.getErrorMessage());		return null;	}}/** * Initial GenericSearchModel *  * @return */function composeSearchData(param){	var searchDataModel=aa.specialSearch.newSearchDataModel().getOutput();	searchDataModel.setEntityType(param.entityType);	searchDataModel.setAuditID(currentUserID);	if(param){		// englishTradeName,arabicTradeName,groupID		if(param.capID!=undefined){			searchDataModel.setServiceProviderCode(param.capID.getServiceProviderCode());			searchDataModel.setCapID(param.capID);		}		if(param.entityID!=undefined){			searchDataModel.setEntityID(param.entityID);		}		if(param.englishFieldValue!=undefined){			searchDataModel.setSearchData1(param.englishFieldValue);		}		if(param.originalEnglishTradeName!=undefined){			searchDataModel.setOriginData1(param.originalEnglishTradeName);		}		if(param.arabicFieldValue!=undefined){			searchDataModel.setSearchData2(param.arabicFieldValue);		}		if(param.originalArabicTradeName!=undefined){			searchDataModel.setOriginData2(param.originalArabicTradeName);		}		if(param.groupID!=undefined){			searchDataModel.setSearchGroupID(param.groupID);		}	}	return searchDataModel;}function createGSearchDataFromASI(){	var tradeNameFieldList=retrieveSearchDataFromASI();	if(tradeNameFieldList){		var result=[];		var groupID=0;		var preferedTradeName=null;		for(var i=0;i<tradeNameFieldList.length;++i){			var obj=tradeNameFieldList[i];			if(obj.englishFieldValue || obj.arabicFieldValue){				var searchDataModel=composeSearchData({					englishFieldValue			:	obj.englishFieldValue,					arabicFieldValue			:	obj.arabicFieldValue,					groupID						:	groupID,					originalEnglishTradeName	:	obj.originalEnglishTradeName,					originalArabicTradeName		:	obj.originalArabicTradeName,					entityID					:	altID,					capID						:	capID,					entityType					:	'TRADENAME'				});				aa.print("obj.isPrefered:\t"+obj.isPrefered);				if(obj.isPrefered){					preferedTradeName=searchDataModel;				}				result[groupID]=searchDataModel;				groupID++;			}		}		aa.specialSearch.recreateBatchSearchData(capID,result);		aa.print("preferedTradeName:\t"+preferedTradeName);		if(preferedTradeName!=null){			updateShortNotes(preferedTradeName.getOriginData1());			aa.print(preferedTradeName.getOriginData1());			editAppName(preferedTradeName.getOriginData2())			aa.print(preferedTradeName.getOriginData2());		}	}	}function updateShortNotes(newShotNotes){	var cdScriptObj = aa.cap.getCapDetail(capID).getOutput();	var capDetial = cdScriptObj.getCapDetailModel();	capDetial.setShortNotes(newShotNotes);	aa.cap.editCapDetail(capDetial)}function editAppName(newname) {	capResult = aa.cap.getCap(capID)	capModel = capResult.getOutput().getCapModel()	capModel.setSpecialText(newname)	setNameResult = aa.cap.editCapByPK(capModel)}if(filterName=='TRADENAME'){	createGSearchDataFromASI();}//aa.env.setValue("ScriptReturnCode","0");//aa.env.setValue("ScriptReturnMessage","ApplicationSpecificInfoUpdateAfter successful");